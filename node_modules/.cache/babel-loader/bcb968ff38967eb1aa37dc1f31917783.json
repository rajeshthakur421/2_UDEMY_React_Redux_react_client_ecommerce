{"ast":null,"code":"var _jsxFileName = \"/home/rudransh/public_html/react-redux/client/src/pages/Checkout.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport { getUserCart, emptyUserCart, saveUserAddress, applyCoupon, createCashOrderForUser } from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({\n  history\n}) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\"); // discount price\n\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n  const dispatch = useDispatch();\n  const {\n    user,\n    COD\n  } = useSelector(state => ({ ...state\n  }));\n  const couponTrueOrFalse = useSelector(state => state.coupon);\n  useEffect(() => {\n    getUserCart(user.token).then(res => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    } // remove from redux\n\n\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: []\n    }); // remove from backend\n\n    emptyUserCart(user.token).then(res => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then(res => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then(res => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n\n      if (res.data) {\n        setTotalAfterDiscount(res.data); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true\n        });\n      } // error\n\n\n      if (res.data.err) {\n        setDiscountError(res.data.err); // update redux coupon applied true/false\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false\n        });\n      }\n    });\n  };\n\n  const showAddress = () => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ReactQuill, {\n    theme: \"snow\",\n    value: address,\n    onChange: setAddress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-primary mt-2\",\n    onClick: saveAddressToDb,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, \"Save\"));\n\n  const showProductSummary = () => products.map((p, i) => /*#__PURE__*/React.createElement(\"div\", {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, p.product.title, \" (\", p.color, \") x \", p.count, \" =\", \" \", p.product.price * p.count)));\n\n  const showApplyCoupon = () => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"input\", {\n    onChange: e => {\n      setCoupon(e.target.value);\n      setDiscountError(\"\");\n    },\n    value: coupon,\n    type: \"text\",\n    className: \"form-control\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: applyDiscountCoupon,\n    className: \"btn btn-primary mt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }\n  }, \"Apply\"));\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then(res => {\n      console.log(\"USER CASH ORDER CREATED RES \", res); // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\"); // empty redux cart\n\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: []\n        }); // empty redux coupon\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false\n        }); // empty redux COD\n\n        dispatch({\n          type: \"COD\",\n          payload: false\n        }); // mepty cart from backend\n\n        emptyUserCart(user.token); // redirect\n\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }\n  }, \"Delivery Address\"), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 9\n    }\n  }), showAddress(), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 9\n    }\n  }, \"Got Coupon?\"), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 9\n    }\n  }), showApplyCoupon(), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }\n  }), discountError && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"bg-danger p-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 27\n    }\n  }, discountError)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }\n  }, \"Order Summary\"), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 9\n    }\n  }, \"Products \", products.length), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }\n  }), showProductSummary(), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }\n  }, \"Cart Total: \", total), totalAfterDiscount > 0 && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"bg-success p-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, \"Discount Applied: Total Payable: $\", totalAfterDiscount), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 11\n    }\n  }, COD ? /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-primary\",\n    disabled: !addressSaved || !products.length,\n    onClick: createCashOrder,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 15\n    }\n  }, \"Place Order\") : /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-primary\",\n    disabled: !addressSaved || !products.length,\n    onClick: () => history.push(\"/payment\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 15\n    }\n  }, \"Place Order\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    disabled: !products.length,\n    onClick: emptyCart,\n    className: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }, \"Empty Cart\")))));\n};\n\nexport default Checkout;","map":{"version":3,"sources":["/home/rudransh/public_html/react-redux/client/src/pages/Checkout.js"],"names":["React","useEffect","useState","useSelector","useDispatch","toast","getUserCart","emptyUserCart","saveUserAddress","applyCoupon","createCashOrderForUser","ReactQuill","Checkout","history","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","user","COD","state","couponTrueOrFalse","token","then","res","console","log","JSON","stringify","data","cartTotal","emptyCart","window","localStorage","removeItem","type","payload","success","saveAddressToDb","ok","applyDiscountCoupon","err","showAddress","showProductSummary","map","p","i","product","title","color","count","price","showApplyCoupon","e","target","value","createCashOrder","setTimeout","push","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n  createCashOrderForUser,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user, COD } = useSelector((state) => ({ ...state }));\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\n      console.log(\"USER CASH ORDER CREATED RES \", res);\n      // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\n        // empty redux cart\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: [],\n        });\n        // empty redux coupon\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n        // empty redux COD\n        dispatch({\n          type: \"COD\",\n          payload: false,\n        });\n        // mepty cart from backend\n        emptyUserCart(user.token);\n        // redirect\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            {COD ? (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={createCashOrder}\n              >\n                Place Order\n              </button>\n            ) : (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={() => history.push(\"/payment\")}\n              >\n                Place Order\n              </button>\n            )}\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}